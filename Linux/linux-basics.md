# 誰でもわかる Linux基礎＆Linuxサーバ構築
# Linuxの概要
## Linuxカーネル
- Linuxの中核となるプログラム
- HWとSWがうまく連携するための橋渡しをする。
    - 厳密にはLinuxというのはカーネル部分だけを指す。
- 私たちが普段使う Ubuntu / AlmaLinux / Debian などのOS全体は以下をまとめたもの。
    - Linuxカーネル
    - ユーザーランド（シェルやコマンド、ライブラリ、ツール群）
    - これをまとめて配布しているのが ディストリビューション（ディストロ）
## Linuxカーネル
- Linus Torvaldsが最初に開発（1991年〜）。
- 今では世界中の開発者が参加してメンテナンスされている巨大プロジェクト。
- ハードウェア制御、プロセス管理、システムコールの提供など「OSの心臓部」。
## GNUプロジェクト（ユーザーランド）
- Richard Stallman（FSF）が1983年に開始した「自由なUnix互換システム」を目指したプロジェクト。
- bash, ls, cat, ps, gcc, glibc など、ユーザーが直接触るコマンドやライブラリを多数提供。
- 「OSの外側部分」（ユーザーが操作する環境）を作っている。
## ディストリビューション開発者
- Ubuntu, Debian, Red Hat, AlmaLinux などの開発チーム。
- Linuxカーネル + GNUツール群 + 独自の管理ツールやパッケージ管理システムを組み合わせて1つの完成したOSにする。
- さらに、セキュリティパッチ、リポジトリの運営、サポートポリシーを提供。

# Linuxの基本操作
## アカウント
- ユーザーの管理単位
    - システムを管理
    - システムを利用
- 3種類のユーザ区分
    - 管理者ユーザ 
        - root, スーパーユーザー(#)
        - 強力な権限があり、重要なファイルなども削除できる
    - システム・ユーザ
        - システムアカウントと言われ、システム内部での特定のプログラムを実行するための専用アカウント（DB,WEBなど）
    - 一般ユーザー($)
        - 一般ユーザーのディレクトリが用意され、制限の範囲内で自由に操作できる
        - 一般ユーザーのアカウントは管理者ユーザが作成することができる

```bash
[ユーザ名@ホスト名 カレントディレクトリ名] $
ホスト名・・・コンピュータに付けられた名前
```
## シャットダウン
```bash
# 今すぐに
shutdown -h now
shutdown -h +10
# 20:00に再起動
shutdown -r 20:0
```

# ファイルとディレクトリ
## 4種類のファイル
- 使用するデータはファイル単位で管理するのが一般でありLinuxのフィルは4種類に分けられる
    - 通常ファイル
        - 「テキストファイル」と「バイナリファイル」に分けることができる
    - ディレクトリファイル
    - リンクファイル
        - ショートカットのようなファイルの実体を指し示すファイル。2種類ある。
        - 「ハードリンク」：ファイルの実体をを直接指し示して共有
            - ファイルの実体そのもの（inode）を共有するリンク。
            - 元ファイルを消しても、ハードリンクが残っていればデータは残る。
            - 同じ中身を別名で持っている
        - 「シンボリックリンク」：ファイルの実体が保管されているパスを示す疑似的なファイルを作成する
            - 元のファイルを消すとリンクは「壊れたリンク」になる
    -  特殊ファイル
        - デバイスファイルとも呼ばれる
        - 周辺装置（入出力ファイル、外部記憶装置）をファイルを通して扱えるようにしたもの
## Linuxのシステム構成
- extを採用したルートディレクトリを頂点とする階層構造
　- ext3、ext4というファイルシステムを採用
### ファイルシステムとは？
- ストレージ（HDD, SSD, USBなど）上でファイルをどう管理するかを決める仕組み。
- OSが「データの場所・名前・アクセス権限」などを正しく扱えるようにする役割。
- 例えると…
    - ハードディスク = ただの空っぽの倉庫
    - ファイルシステム = 倉庫の中の棚の並べ方・住所の付け方
    - ファイル = 棚に置かれた荷物
- windowsはNTFS
## 絶対パス
- ルートディレクトリを起点として、場所を表す方法
## 相対パス
- カレントディレクトリを起点として場所を表す方法
### ホームディレクトリ
- ログインした時のカレントディレクトリ
```bash
/home/ユーザ名
```

## ディレクトリ操作コマンド
### mkdir
```bash
# 親ディレクトリも同時に作成する
mkdir -p test
# パーミッションも同時に指定
mkdir -m 777 test

# ルートディレクトリ
/
# ホームディレクトリ
~

# ディレクトリ削除
# 親ディレクトリごと削除。中身が空であること
rmdir -p test

# 行番号あり
cat -n
cat -n ファイル名 | less

# 削除
# ディレクトリを中身ごと
rm -r 
# 強制的に
-f
```

# ユーザとグループ
## ユーザ
- ユーザとは利用者を区別する単位
- ユーザ情報
    - 「/etc/passwd」に記録されている。
- パスワード
    - 「/etc/shadow」に記録されている。
    - ユーザのパスワードを暗号化して格納するファイル。管理者ユーザしか見られない。
```bash
# ユーザ情報
# ユーザ名:暗号化されたパスワード:ユーザID(UID):グループID(GID):コメント:ホームディレクトリ:ログインシェル
student:x:1000:1000:student:/home/student:/bin/bash

# パスワード
# ユーザ名:暗号化されたパスワード:最後にパスワードが変更された日までの日数:パスワードが変更できるまでの日数:変更しないといけなくなるまでの日数:有効期限前に警告を受ける日数
student:******::0:99999:7:::

```

### id
```bash
[root@alma-linux-udemy ~]# id student
uid=1000(student) gid=1000(student) groups=1000(student)
# ユーザーID、グループID、所属グループ
```

### su
- ユーザの切り替え
- 他のユーザアカウントに切り替える

```bash
# 管理者
su
su -
su - root

# 一般ユーザから他ユーザ
su test
su - test
```

### ユーザの作成
- useradd
  - 管理者のみ可能
```bash
# 新規のユーザアカウントを追加
useradd user01
# ユーザIDを「2000」として、新規のユーザアカウントを追加
useradd -u 2000 user02
```

### ユーザのパスワード設定
- passwd
  - 管理者のみ可能
  - ユーザ名を省略すると、一般ユーザで自分自身のパスワードを変更可能
```bash
passwd user01

# root自体のパスワード変更も可能
passwd
```

### ユーザの削除
- userdel
  - 管理者のみ可能
```bash
# ユーザの削除
userdel user01

# -rをつけないとホームディレクトリが削除されない
# /var/spool/mail/user01（メールスプール）も削除？
userdel -r user01
```

## グループ
- 複数の利用者をひとまとめとして扱う
- `/etc/group` に情報が記載されている

```bash
# グループ名:暗号化されたパスワード:グループid:参加ユーザ
# グループ名と参加ユーザ名が同じであれば参加ユーザーは省略される場合も
student:x:1000:student
```

### 所属グループの確認
- groups
  - プライマリグループ
  - サブグループ
```bash
groups user01
# 実行結果
# ユーザ名：所属グループ
user01 : user01

# ログイン中のユーザのグループ表示
groups
```

### グループの作成
- groupadd
  - rootのみ
```bash
groupadd 新しいグループ名

# グループid付与
groupadd -g 1002 新しいグループ名
```

### ユーザのグループ追加
### ユーザーのアカウント情報を変更する
- usermod
  - rootのみ
```bash
# ユーザーのプライマリグループを変更する
usermod -g グループ名 ユーザ名
# ユーザーのサブグループを変更する（複数指定可能）
usermod -G グループ名 ユーザ名
usermod -G グループ名, グループ名 ユーザ名
# 例
usermod -g sample user01
usermod -G sample01, sample02 user01
```

```bash
[root@alma-linux-udemy ~]# id user01
uid=1001(user01) gid=1001(user01) groups=1001(user01)
[root@alma-linux-udemy ~]# usermod -G group01 user01
[root@alma-linux-udemy ~]#
[root@alma-linux-udemy ~]# id user01
uid=1001(user01) gid=1001(user01) groups=1001(user01),1002(group01)

/etc/group
group01:x:1002:user01
```

# ファイルの種類と属性
## ファイルの状態
```bash
- ファイルの種類
所有ユーザのパーミッション
所有グループのパーミッション
第3社のパーミッション
-rwxrwxrwx
```

- ファイルの種類
  - 通常dファイル -
  - ディレクトリ d
  - リンクファイル l
  - 特殊ファイル bまたはc

- パーミッションとは？
  - ファイルやディレクトリに対するユーザのアクセス権
  - 読込(r)、書込(w)、実行(x)の権限の有無を設定。

- 第３者とは？
  - 所有ユーザでもなく、グループにも所属してない者。

- fileコマンド
  - 拡張子がないファイルが多いため、fileで調べる。
```bash
file sample.txt
```

-  所有者の変更(chown)

```bash
# グループの所有を変更
ll
-rw-r--r--. 1 user01 user01 4 11月  4 23:08 sample.txt
chown :group01 sample.txt

ll
-rw-r--r--. 1 user01 group01 4 11月  4 23:08 sample.txt
# ファイルの所有者を変更
chown student sample.txt
ll
-rw-r--r--. 1 student group01 4 11月  4 23:08 sample.txt
# 同時変更
chown student:group01 sample.txt
```
